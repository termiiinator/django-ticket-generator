{% extends 'tickets/base.html' %}

{% block title %}–ë–∏–ª–µ—Ç ‚Ññ{{ ticket_number }} - {{ subject }}{% endblock %}

{% block extra_css %}
<style>
    .controls-bar {
        background: var(--surface);
        box-shadow: 0 4px 24px var(--shadow);
        padding: 20px 0;
        margin-bottom: 32px;
        border-radius: 16px;
        border: 2px solid var(--border);
    }

    .controls-container {
        display: flex;
        gap: 12px;
        justify-content: center;
        flex-wrap: wrap;
        align-items: center;
    }

    .ticket-container {
        display: flex;
        justify-content: center;
        align-items: flex-start;
        padding: 40px 0 80px;
        animation: fadeInUp 0.6s ease-out;
    }

    .ticket {
        background: white;
        width: 250mm;
        height: 135mm;
        padding: 18mm;
        box-shadow: 0 16px 64px rgba(15, 23, 42, 0.15);
        font-family: 'Times New Roman', serif;
        border: 1px solid var(--border);
        border-radius: 4px;
        position: relative;
    }

    .ticket::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 8px;
        background: linear-gradient(90deg, 
            var(--primary) 0%, 
            var(--accent) 50%, 
            var(--success) 100%
        );
    }

    .ticket-header {
        text-align: center;
        border-bottom: 3px solid var(--primary);
        padding-bottom: 10px;
        margin-bottom: 14px;
    }

    .ticket-header .ministry {
        font-size: 13px;
        font-weight: 600;
        margin-bottom: 4px;
        color: var(--text);
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .ticket-header .university {
        font-size: 14px;
        font-weight: 600;
        margin-bottom: 6px;
        color: var(--text);
    }

    .ticket-header .department {
        font-size: 13px;
        margin-bottom: 10px;
        color: var(--text-muted);
    }

    .ticket-header .subject {
        font-weight: 700;
        font-size: 18px;
        margin-top: 10px;
        margin-bottom: 6px;
        color: var(--primary);
        letter-spacing: 0.3px;
    }

    .ticket-header .number {
        font-size: 15px;
        margin-top: 6px;
        color: var(--text-muted);
        font-weight: 600;
    }

    .ticket-content {
        margin-bottom: 14px;
    }

    .question {
        font-size: 14px;
        margin-bottom: 8px;
        line-height: 1.5;
        color: #1a1a1a;
        padding-left: 4px;
    }

    .question:hover {
        background: rgba(245, 158, 11, 0.03);
    }

    .ticket-footer {
        margin-top: 18px;
        padding-top: 10px;
        border-top: 2px solid #e5e7eb;
        font-size: 13px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .ticket-footer .signature {
        font-weight: 600;
        color: var(--text);
    }

    .ticket-footer .date {
        color: var(--text-muted);
        font-weight: 600;
    }

    .btn-group {
        display: inline-flex;
        gap: 8px;
    }

    @media print {
        @page {
            size: A4 landscape;
            margin: 0;
        }

        body {
            margin: 0;
            padding: 0;
            background: white;
        }

        body::before {
            display: none;
        }

        .ticket-container {
            background: white;
            padding: 0;
        }

        .ticket {
            box-shadow: none;
            margin: 0;
            border: none;
        }

        .controls-bar {
            display: none !important;
        }
    }

    @media (max-width: 768px) {
        .ticket {
            width: 100%;
            height: auto;
            min-height: 135mm;
        }

        .controls-container {
            flex-direction: column;
        }

        .btn-group {
            width: 100%;
            flex-direction: column;
        }

        .btn-group .btn {
            width: 100%;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="controls-bar no-print">
    <div class="container">
        <div class="controls-container">
            <a href="{% url 'index' %}" class="btn btn-secondary">
                ‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è
            </a>
            
            <div class="btn-group">
                <form method="post" action="{% url 'generate_ticket' %}" style="display: inline;">
                    {% csrf_token %}
                    <input type="hidden" name="subject" value="{{ subject_code }}">
                    <button type="submit" class="btn btn-success">
                        üîÑ –ù–æ–≤—ã–π –≤–∞—Ä–∏–∞–Ω—Ç
                    </button>
                </form>
                
                <button onclick="window.print()" class="btn btn-primary">
                    üñ®Ô∏è –ü–µ—á–∞—Ç—å
                </button>
                
                <button onclick="copyTicket()" class="btn btn-accent">
                    üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
                </button>
            </div>
        </div>
    </div>
</div>

<div class="ticket-container">
    <div class="ticket">
        <!-- –®–∞–ø–∫–∞ -->
        <div class="ticket-header">
            <div class="ministry">–ú–ò–ù–ò–°–¢–ï–†–°–¢–í–û –û–ë–†–ê–ó–û–í–ê–ù–ò–Ø</div>
            <div class="university">–ê–∑–µ—Ä–±–∞–π–¥–∂–∞–Ω—Å–∫–∏–π –ì–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–π –£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç –ù–µ—Ñ—Ç–∏ –∏ –ü—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ—Å—Ç–∏</div>
            <div class="department">–ö–∞—Ñ–µ–¥—Ä–∞ –û–±—â–µ–π –∏ –ü—Ä–∏–∫–ª–∞–¥–Ω–æ–π –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∏</div>
            <div class="subject">{{ subject }}</div>
            <div class="number">–≠–∫–∑–∞–º–µ–Ω–∞—Ü–∏–æ–Ω–Ω—ã–π –±–∏–ª–µ—Ç ‚Ññ {{ ticket_number }}</div>
        </div>

        <!-- –í–æ–ø—Ä–æ—Å—ã -->
        <div class="ticket-content">
            {% if is_physics %}
                <!-- –§–∏–∑–∏–∫–∞ - —Ç–æ–ª—å–∫–æ –≤–æ–ø—Ä–æ—Å—ã -->
                {% for question in physics_questions %}
                <div class="question">
                    {{ forloop.counter }}. {{ question.text }}
                </div>
                {% endfor %}
            {% else %}
                <!-- –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã - —Ç–æ–ª—å–∫–æ –≤–æ–ø—Ä–æ—Å—ã -->
                {% for question in theory_questions %}
                <div class="question">
                    {{ forloop.counter }}. {{ question.text }}
                </div>
                {% endfor %}
                
                {% for question in practice_questions %}
                <div class="question">
                    {{ forloop.counter|add:theory_questions|length }}. {{ question.text }}
                </div>
                {% endfor %}
            {% endif %}
        </div>

        <!-- –ü–æ–¥–ø–∏—Å—å -->
        <div class="ticket-footer">
            <span class="signature">–ü–æ–¥–ø–∏—Å—å —Å—Ç—É–¥–µ–Ω—Ç–∞: _______________</span>
            <span class="date">{{ date }}</span>
        </div>
    </div>
</div>

<script>
function copyTicket() {
    let text = `–≠–ö–ó–ê–ú–ï–ù–ê–¶–ò–û–ù–ù–´–ô –ë–ò–õ–ï–¢ ‚Ññ {{ ticket_number }}\n–ü—Ä–µ–¥–º–µ—Ç: {{ subject }}\n–î–∞—Ç–∞: {{ date }}\n\n`;
    
    {% if is_physics %}
        {% for question in physics_questions %}
        text += '{{ forloop.counter }}. {{ question.text|escapejs }}\n';
        {% endfor %}
    {% else %}
        {% for question in theory_questions %}
        text += '{{ forloop.counter }}. {{ question.text|escapejs }}\n';
        {% endfor %}
        {% for question in practice_questions %}
        text += '{{ forloop.counter|add:theory_questions|length }}. {{ question.text|escapejs }}\n';
        {% endfor %}
    {% endif %}
    
    navigator.clipboard.writeText(text).then(() => {
        // –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        const notification = document.createElement('div');
        notification.className = 'message success';
        notification.textContent = '‚úì –ë–∏–ª–µ—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞';
        notification.style.position = 'fixed';
        notification.style.top = '24px';
        notification.style.right = '24px';
        notification.style.zIndex = '10000';
        document.body.appendChild(notification);
        
        setTimeout(() => {
            notification.style.opacity = '0';
            notification.style.transform = 'translateX(400px)';
            setTimeout(() => notification.remove(), 300);
        }, 2500);
    });
}
</script>
{% endblock %}
